
############################################################
######################## 10/16/2020 ########################
############################################################

Data location on Talapas: /projects/bgmp/shared/groups/2020/neuron_nerds

$ ml spider cellranger
  cellranger: cellranger/3.0.2

### Notes on cellranger stuff:
Gene-Cell count matrix (Cell Ranger)
-	Keep metadata 
-	Build pipeline and assume we are getting another timepoint dataset
-	Makowski (2015, scRNA OG)

$ cellranger count --id=sample345 \
                   --transcriptome=/opt/refdata-gex-GRCh38-2020-A \
                   --fastqs=/home/jdoe/runs/HAWT7ADXX/outs/fastq_path \
                   --sample=mysample \
                   --expect-cells=1000 \
                   --localcores=8 \
                   --localmem=64

### Matt and Chirs ran these scripts for running cellranger counts:
#!/bin/bash
#SBATCH --account=bgmp
#SBATCH --partition=bgmp
#SBATCH --job-name=count_test_%j
#SBATCH --output=count_test_%j.out
#SBATCH --error=count_test_%j.err
#SBATCH --time=1-23:59:59
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=8
#SBATCH --mem=64GB

conda activate bgmp_py37
module load cellranger/3.0.2

dir="/projects/bgmp/shared/groups/2020/neuron_nerds"

----------------

/usr/bin/time -v \
cellranger count --id=P10_test \
--fastqs=$dir/THE_DATA \
--sample=P10 \
--transcriptome=$dir/refdata-gex-mm10-2020-A \
--localcores=8 \
--localmem=64

----------------


##### Another version of the script???

cellranger count --id=P10_test \
--fastqs=/projects/bgmp/shared/groups/2020/neuron_nerds/THE_DATA \
--sample=P10 \
--transcriptome=/projects/bgmp/shared/groups/2020/neuron_nerds/refdata-gex-mm10-2020-A \
--localcores=8 \
--localmem=64 \


### Need to remove the last letter from the sequence line and \
quality score line before running cellranger count:
Scripts:
$ cat trimread1.sh
  #!/bin/bash
  #SBATCH --partition=bgmp        ### Partition (like a queue in PBS)
  #SBATCH --cpus-per-task=1       ### Number of tasks to be launched
  #SBATCH --account=bgmp          ### Account used for job submission

  zcat P10_S1_L001_R1_001.fastq.gz | sed '2~4s/[ATCGN]$//' | sed '4~4s/[!-J]$//' > P10Trimmed_S1_L001_R1_001.fastq

  gzip P10Trimmed_S1_L001_R1_001.fastq

$ cat trimread2.sh 
  #!/bin/bash
  #SBATCH --partition=bgmp        ### Partition (like a queue in PBS)
  #SBATCH --cpus-per-task=1       ### Number of tasks to be launched
  #SBATCH --account=bgmp          ### Account used for job submission

  zcat P10_S1_L001_R2_001.fastq.gz | \
  sed '2~4s/[ATCGN]$//' | \
  sed '4~4s/[!-J]$//' > P10Trimmed_S1_L001_R2_001.fastq

  gzip P10Trimmed_S1_L001_R2_001.fastq

$ sbatch trimread2.sh 
Submitted batch job 13243041


### Script for running cellranger counts on R1Trimmed file:
---------------------------------------------
#!/bin/bash
#SBATCH --job-name=trimmed_count_%j
#SBATCH --account=bgmp
#SBATCH --partition=bgmp
#SBATCH --output=trimmed_count_%j.out
#SBATCH --error=trimmed_count_%j.err
#SBATCH --time=1-23:59:59
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=8
#SBATCH --mem=64G

conda activate bgmp_py37
module load cellranger/3.0.2

dir="/projects/bgmp/shared/groups/2020/neuron_nerds"

/usr/bin/time -v \
bin/cellranger count \
--id Trimmed_R1_count \
--fastqs $dir/THE_DATA \
--sample P10 \
--transcriptome $dir/refdata-gex-mm10-2020-A \
--localcores 8 \
--localmem 64 \
--r1-length 26


############################################################
######################## 10/17/2020 ########################
############################################################

### Only need to trim R1... 10X version 2 protocol has a uniform 16 bp cell-barcode followed \
by a 10 bp UMI, but the read was sequenced to 27 bases instead of 26. All of the sequences in \
R2 contain important information that doesn't need to be edited!!!

### Made a new dir and moved all of the manually trimmed files to $dir/THE_DATA/TRIMMED_FASTQs

### Running final script for cellranger_count (in /neuron_nerds/):
$ nano cellranger_count.sh

#!/usr/bin/env bash

#SBATCH --job-name=trimmed_count_%j
#SBATCH --account=bgmp
#SBATCH --partition=bgmp
#SBATCH --output=trimmed_count_%j.out
#SBATCH --error=trimmed_count_%j.err
#SBATCH --time=1-23:59:59
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=8
#SBATCH --mem=64G

conda activate bgmp_py37
module purge
module load slurm/19.05 gcc/7.3 cellranger/3.0.2

dir="/projects/bgmp/shared/groups/2020/neuron_nerds"

/usr/bin/time -v \
cellranger count \
--id=Trimmed_count \
--fastqs=$dir/THE_DATA/TRIMMED_FASTQs \
--sample=P10Trimmed \
--transcriptome=$dir/refdata-gex-mm10-2020-A \
--localcores=8 \
--localmem=64 

$ sbatch cellranger_counts.sh 
Submitted batch job 13250720

### Resuts from the usr/bin/time :
$ cat trimmed_count_13250720.err
	Command being timed: "cellranger count --id=Trimmed_count --fastqs=/projects/bgmp/shared/groups/2020/neuron_nerds/THE_DATA/TRIMMED_FASTQs --sample=P10Trimmed --transcriptome=/projects/bgmp/shared/groups/2020/neuron_nerds/refdata-gex-mm10-2020-A --localcores=8 --localmem=64"
	User time (seconds): 98237.60
	System time (seconds): 4029.19
	Percent of CPU this job got: 580%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 4:53:31
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 12569408
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 617113875
	Voluntary context switches: 88025920
	Involuntary context switches: 419972
	Swaps: 0
	File system inputs: 0
	File system outputs: 144
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0

### All outputted information is here:
/projects/bgmp/shared/groups/2020/neuron_nerds/Trimmed_count

### Transfer output files to my computer for visualizing:
$ scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/Trimmed_count/outs/web_summary.html \
/Users/agray11/bioinformatics/Fall2020/Bi624_Lab

### After checking with the original html that Max (from the Yu lab) sent us, I'm not sure if 
the counts output was correct... There are very different numbers of cells, reads, coverage,
etc. Will check back with our group and talk it over with Pete. Next step is to get Rstudio
running on Talapas so we can start working on the Seurat portion.

############################################################
######################## 10/22/2020 ########################
############################################################

### Steps for getting an interactive node on Talapas to run R/Rstudio:
talapas-ln1.uoregon.edu --> Interactive Session --> ** fill out information **
  ** Check what Seurat is asking for because it sometimes needs multi threads or cores!!

--> open terminal
$ module load rstudio/1.0
$ module load R/4.0.2

--> open rstudio from talapas terminal
$ rstudio

### Installing packages on Rstudio/Talapas:
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.package("BiocManager")
BiocManager::install("edgeR")
install.packages("RColorBrewer")
install.packages("Seurat")

############################################################
######################## 10/26/2020 ########################
############################################################

### These packages live in R directory on my home directory (only need to load in once):
$ cd ~
$ ls
bgmp        bio610   Documents  happy.sh  ncbi      Pictures  R    Templates       Videos
BI608-2020  Desktop  Downloads  Music     ondemand  Public    src  Untitled.ipynb

### For each time to use Rstudio on Talapas:
$ module load rstudio/1.0
$ module load R/4.0.2
$ rstudio
library(Seurat)
library(dplyer)
library(patchwork)

### Chris reran the cellranger counts using v.4 which eliminates the polyA and adapter \
contamination in the fastq file. He will walk through Seurat standard vignette for \
the outs/matrix/filtered. I will do the outs/matrix/raw analysis and we will compare!!

R.script.file = /projects/bgmp/shared/groups/2020/neuron_nerds/alyx/Trimmed_count_test.R
10X.project.dir = /projects/bgmp/shared/groups/2020/neuron_nerds/chris/Trimmed_count/outs/raw_feature_bc_matrix

> packageVersion("seurat")
[1] ‘3.2.2’

############################################################
######################## 10/30/2020 ########################
############################################################

### Turns out that Max and the Yu lab did not send us the full data...
we were short about 100 million reads! Matt finished downloading the 
new, full data yesterday and trimmed the R1 read just like we did yesterday.

New location of trimmed data: 
/projects/bgmp/shared/groups/2020/neuron_nerds/full_data/TrimmedFull

### Rerunning Cell Ranger counts script with the new files:

#!/usr/bin/env bash

#SBATCH --job-name=cellrangerV4_count_%j
#SBATCH --account=bgmp
#SBATCH --partition=bgmp
#SBATCH --output=cellrangerV4_count_%j.out
#SBATCH --error=cellrangerV4_count_%j.err
#SBATCH --time=1-23:59:59
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=8
#SBATCH --mem=64G

conda activate bgmp_py37

dir="/projects/bgmp/shared/groups/2020/neuron_nerds"

/usr/bin/time -v \
$dir/CellRanger/cellranger-4.0.0/bin/cellranger count \
--id=Full_trimmed_count \
--fastqs=$dir/full_data/TrimmedFull \
--sample=L35291_Trimmed \
--transcriptome=$dir/refdata-gex-mm10-2020-A \
--localcores=8 \
--localmem=64

$ scp /Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project/cellranger_countsV4.sh \
agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/alyx 

$ sbatch cellranger_countsV4.sh 
Submitted batch job 13521385

### Will check back in ~5 hours! Meeting with Matt and Chris today to review
Seurat stuff. Working on the older, incomplete dataset to learn more about
Seurat arguments/commands.

############################################################
######################## 11/05/2020 ########################
############################################################

### Parameters for running interactive node on Talapas:
Need at least 2-4 cores (?)
Definitely need > 40G memory when working with the raw_counts data.

### Rate limiting parts:
- ScaleData() *** LONGish ***
- RunPCA() **** LONGish ****
- JackStraw() *** LONG LONG time (more than 30 min) ***
- FindMarkers() *** about 7-10 minutes per cluster!! ***

############################################################
######################## 11/10/2020 ########################
############################################################

### Working to knit the raw data 10% mt cutoff into an HTML doc.
Also trying to create a labeled features plot for each of the clusters
near the end of the analysis (to give to Dr. Ron during our meeting 
next week).

### Trying to install 'umap-learn'
reticulate::py_install('umap-learn')
Error: no python is /usr/bin/python ??

## This worked!!! Had to exit out of interactive session, then 
activated conda env and followed the same command to use in 
interactive session:

$ conda activate bgmp_py37
$ ml rstudio/1.0 
$ ml R/4.0.2 
$ rstudio
reticulate::py_install('umap-learn')

### R is crashing after trying to use umap.method = "umap-learn". Will try
a couple more times to see if the code is crashing or if theres not enough
memory? EDIT: don't use 'umap-learn'......!!!???

### When saving files, use saveRDS(object, "path/to/file"), then 
read back into knit file with readRDS("path/to/file").


############################################################
######################## 11/12/2020 ########################
############################################################

### FINALLY got the doc to knit... Not sure how great it looks, but will
talk with Matt and Chris this afternoon.
/projects/bgmp/shared/groups/2020/neuron_nerds/alyx/seurat_rawP10.html

$ scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/alyx/seurat_rawP10.html \
/Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project

$ mv seurat_rawP10.html seurat_raw_mt10_v1.html

### Ananolgy for layperson talk:
- Building a piano 
- Once deadline for piano building is over, whatever keys have mapped to 
its string (to make a final tune) is set.
- Over time, the strings deform, they detach, break, etc. and this 

############################################################
######################## 11/13/2020 ########################
############################################################

### HAPPY FRIDAY THE 13TH!!!!

### Installed R package 'ggpubr' for ggarrange plots on Talapas.

### Knitted a second html and transferred to my local comp:
$ scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/alyx/seurat_rawP10.html \
/Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project
$ mv seurat_rawP10.html seurat_raw_mt10_v2.html

### Currently knitting a v3, will check back soon...

### Knitted a third html and transferred to my local comp:
$ scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/alyx/seurat_rawP10.html \
/Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project
$ mv seurat_rawP10.html seurat_raw_mt10_v3.html

############################################################
######################## 11/30/2020 ########################
############################################################

### Finished searching the literature for cell markers for all cell types
found in the olfactory epithelium. This list is in the Google drive.

### Doing SCtransform after subsetting for percent.mt < 2% and 2.5%. 
Only requested 1 core with 40 GB, but SCtransform step seems to take
pretty long. May want to increase cores?

### Rstudio crashed during SCTransform step. Increased cores to 2 and 
memory is still 40 GB. Still taking some time to perform this step...

### Keep receiving warning that "iteration limit reached":
https://github.com/ChristophH/sctransform/issues/25
Seems to mean that there are some genes that are difficult to estimate
theta parameter because of non-zero observations. This issue conversation
says to not worry about these at all!!

############################################################
######################## 12/02/2020 ########################
############################################################

### Knitting p10_mt2 and p10_mt2.5 documents. Added new cell markers 
from previous research. Will meet with Chris and Matt today to discuss
results. I think these two cutoffs are too drastic and need to be 
increased because distinct HBC and other populations are lost with this
low cutoff. 

### Clarification on the SCTransform "vars.to.regress" :
https://github.com/satijalab/seurat/issues/3061

### Transferring the knitted htmls to my local computer:
$ scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/alyx/seurat_P10f_sct_mt2.html \
/Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project

$ scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/alyx/seurat_P10f_sct_mt25.html \
/Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project

############################################################
######################## 12/21/2021 ########################
############################################################

### Matt successfully ran the first part of the Velocyto pipeline 
(velocyto.py) which outputs a .loom file to input to the velocyto.R
analysis. He found a script online that did this using our 10x CellRanger 
matrix information and can easily be fed into Seurat analysis also.

Velocyto webpage:
http://velocyto.org/

BAM/SAM --> .loom
http://velocyto.org/velocyto.py/tutorial/cli.html


Vignette for the RNA velocity analysis: 
https://jef.works/blog/2020/01/14/rna_velocity_analysis_tutorial_tips/





############################################################
######################## 01/05/2021 ########################
############################################################

### Installing velocyto on Talapas... Apparently many issues (according to 
Matt and Chris...) - a couple of packages to install first.

$ ml rstudio/1.0
$ ml R/4.0.2
library(devtools)
install_github("velocyto-team/Velocyto.R")
(No updates)

Error message:
Unable to locate HDF5 compliation helper scripts 'h5cc' or 'h5pcc'.
Please specify --with-hdf5-<LOCATION> as the full path to h5cc or h5pcc.
configure: error: hdf5 does not seem to be installed on your platform.
  Please install the hdf5 library.
  The required HDF5 library files can be installed as follows:
    - Debian-based (e.g. Debian >= 8.0, Ubuntu >= 15.04): 'sudo apt-get install libhdf5-dev'
      - Old Debian-based (e.g. Debian < 8.0, Ubunto < 15.04): Install from source (see INSTALL)
ERROR: configuration failed for package 'hdf5r'
* removing '/gpfs/home/agray1/R/x86_64-pc-linux-gnu-library/4.0/hdf5r'

### Trial 2:

$ ml rstudio/1.0
library(devtools)
install_github("velocyto-team/Velocyto.R")

Error messge: 
ERROR: dependencies 'pcaMethods', 'hdf5r' are not available for package 
'velocyto.R'
* removing '/gpfs/home/agray11/R/x86_64-pc-linux-gnu-library/3.5/velocyto.R'
Installation failed: command failed (1)

It went for much longer this time around with not many other errors, at least 
further than the previous installation trial.
 ### Also says: "Unable to locate HDF5 compilation helper scripts 'h5cc' or 'h5pcc'

### Tried to find if these were modules to load from talapas (they aren't):
$ ml spider hdf5r
  NONE
$ ml spider h5cc
  NONE
$ ml spider h5pcc
  NONE

### Trial 3:
$ ml rstudio/1.0
  (Stayed in R/3.5.1 (default when opening rstudio) )
BiocManager::install("pcaMethods") -- Done
BiocManager::install("hdf5r") -- ERROR
  Unable to locate helper scripts 'h5cc' and 'h5pcc'
BiocManager::install("h5cc") -- ERROR
  Installation path not writeable, unable to update packages.
  package 'h5cc' is not avaialble (for R version 3.5.1)
#BiocManager::install("h5pcc")

https://www.bioconductor.org/packages/release/bioc/html/rhdf5.html
### Trial 4:
$ ml purge
$ ml load slurm/19.05 gcc/7.3
$ conda activate bgmp_py37
$ ml load rstudio/1.0
$ ml load R/4.0.2
BiocManager::install("h5cc")
  ERROR: Installation path not writeable, unable to update packages:
library(pcaMethods)
  No package found???
BiocManager::install("pcaMethods") -- DONE 
BiocManager::install("h5cc") -- ERROR
  package 'h5cc' is not available (for R version 4.0.2)
BiocManager::install("rhdf5") -- DONE
library(devtools)
install_github("velocyto-team/Velocyto.R")
  Skip updates
  ERROR: unable to locate HDF5 compliation helper scripts 'h5cc' or 'h5pcc'
BiocManager::install('h5cc')
  ERROR: package 'h5cc' is not available (for R version 4.0.2)

### Trial 5:
$ conda deactivate
$ ml purge
$ ml load slurm/19.05 gcc/7.3
$ ml load rstudio/1.0
$ ml load R/4.0.2
$ rstudio
library(devtools)
install_github("velocyto-team/Velocyto.R")
  Skip updates
  ERROR: unable to locage HDF5 compliation helper scripts 'h5cc' or 'h5pcc'
install.packages("hdf5r")
  ERROR: unable to lcoate HDF5 compilation helper scripts 'h5cc' or 'h5pcc'
install.packages("h5cc")
  WARNING: in install.packages:
    package 'h5cc' is not available (for R version 4.0.2)
install.package('h5pcc')
  WARNING: in install.packages:
    package 'h5pcc' is not availble (for R version 4.0.2)
devtools::install_github("hhoeflin/hdf5r")
  Skip updates
  ERROR: Unable to locate HDF5 compliation helper scripts 'h5cc' or 'h5pcc'

*** SIIIIGGHHHHHHH.......... ***
https://support.hdfgroup.org/HDF5/doc1.6/ADGuide/HISTORY.txt
Searched for 'h5cc' on this website, says this:
  "A helper script called ''h5cc'', which helps compilation of HDF5 programs,
  is not distributed with HDF5. See the reference manul for information on 
  how to use this feature.
Tried to find some more documentation but coming up with nothing.
I have noticed many other issues surrounding installing 'hdf5r' for Seurat...?

### Trial 6:
library(Seurat)
install.packages('hdf5r')
  ERROR: Unable to locate HDF5 compilation helper scripts 'h5cc' or 'h5pcc'
install.packages('h5cc')
  WARNING: in install.packages:
    package 'h5cc' is not available (for R version 4.0.2)
install.package('h5pcc')
  WARNING: in install.packages:
    package 'h5pcc' is not availble (for R version 4.0.2)

### Trial 7 (working with Pete and Jason):
conda create --name velocyto
conda config --add channels conda-forge
conda search r-base
#^ will show you all the versions of R you can choose
conda install r-base=x.y.z

### MEETING WITH JASON AND PETE TO DEBUG:
These were the moves that Jason took to debug, but unfortunately it didn't really work?
$ mamba create -n velocyto 
$ conda activate velocyto
$ mamba install r velocyto.r rstudio r-devtools
rstudio

install.packages('irlba')
install.packages('Rtsne')
install.packages('RANN')
install.packages('igraph')

require(devtools)
library(irlba)
library(Rtsne)
library(RANN)
library(igraph)
library(velocyto.R)
devtools::install_github("JEFworks/MUDAN") ### This fails...
library(MUDAN)

in summary...
* Problems installing r velocyto.r.
* Able to install r-veloctyo.r via conda.
* Also able to install rstudio via conda.
  - Why do this? Possible problems with different versions of R needed
  by different packages such as rstudio and some of the other ones.
    - Maby try installing via source?????
* Rstudio installed via conda requires / ends up with R version 3.6.1
  - Note some packages may be unhappy with 3. 6.1, we don't know yet though.

* Installed other packages from within R (install.packages())
* But MUDAN is being difficult.

* Pete's suggestion of rstudio installed via source might be very promising.
* Another thing to do is look at MUDAN"s R version requirements, if any?
  - See if other people have been able to install MUDAN?
  - First! Install MUDAN in it's own clean environment under different versions of R, just to see if possible...
    - library(sva) is causing the error messages in MUDAN

#########

### FINALLY DID IT!!!!!!!! THIS WORKS!!!
create new conda environment (velocyto)
conda create --name velocyto2
conda config --add channels bioconda
conda config --add channels conda-forge
conda install r-devtools
conda install r-base=4.0.2
conda install -c bioconda r-velocyto.r
conda install r-biomartr
conda list | grep "r-base"
  r-base  4.0.2
conda list | grep "veloc"
  r-velocyto.r  0.6
ml rstudio/1.0
ml R/4.0.2
ml list
  1) slur/19.05   2) gcc/7.3    3) rstudio/1.0    4) R/4.0.2
rstudio
install.packages('Seurat') 
  DONE

### Check these in Rstudio:
library(velocyto.r) # Loaded!
system("type R") # Gives location where R is installed
  R is /packages/R/4.0.2_gcc7/bin/R
file.path(R.home("bin"), "R") # Where R looks for all of its libraries
  [1] "projects/bgmp/agray11/miniconda3/envs/velocyto/lib/R/bin/R
install.packages('Seurat')

### To subset clusters in Seurat (Pete command)
nadia_30dpf_merged_subsetClusters <- SubsetData(object = nadia_30dpf_merged, ident.remove =c(34), do.clean = TRUE, subet.raw = TRUE)
--> then FindVariableClusters, ScaleData, etc.

### Matt submitted a script to change the counts matrix file from .tsv --> .csv 
(so it's compatable with the velocyto.r read.csv())
$ sed 's/\t/,/g' file.tsv > file.csv

### I will work on this vignette to see if we can do RNA velocity.
I'll also try and subcluster for the mOSNs and iOSNs and maybe try to do more downstream analysis?
https://htmlpreview.github.io/?https://github.com/satijalab/seurat.wrappers/blob/master/docs/velocity.html





############################################################
######################## 01/06/2021 ########################
############################################################

### Installing the SeuratWrappers from github:
https://github.com/satijalab/seurat-wrappers

$ conda activate velocyto2
$ ml rstudio/1.0
$ ml R/4.0.2
$ rstudio

remotes::install_github("satijalab/seurat-wrappers")
  DONE

### Trying to load Seurat and when it worked yesterday, now it has stopped...
Uninstalled the Seurat package and will reinstall:
--> in rstudio, go to "Packages" in bottom right box (files, plots, packages, help, viewer)
--> scroll to Seurat and click the "x" on the righthand side.
Restart R session.
install.packages("Seurat")
  DONE
library(Seurat)
  ERROR: package or namespace load failed for 'Seurat' in dyn.load(file, DLLpath = DLLpath, ...):
  unable to load shared object '/gpfs/projects/bgmp/agray11/miniconda3/envs/velocyto2/lib/R/library/png/libs/png.so':
  /lib64/libz.so.1: version 'ZLIB_1.2.9' not found (required by /projects/bgmp/agray11/miniconda3/envs/velocyto2/lib/libpng16.so.16)

### Checked if I could load Seurat library in bgmp_py37 environment:
open new terminal
$ conda activate bgmp_py37
$ ml rstudio/1.0
$ ml R/4.0.2
$ rstudio
library(Seurat)
  Can successfully load library and use commands.

### Trying to troubleshoot Seurat install:
Uninstalled the Seurat package.
Exit rstudio.
$ conda deactivate
$ ml purge
$ ml slurm/19.05 gcc/7.3
$ conda activate velocyto2
$ ml rstudio/1.0
$ ml R/4.0.2
$ rstudio
install.packages('Seurat')
  DONE
library(Seurat)
ERROR: package or namespace load failed for 'Seurat' in dyn.load(file, DLLpath = DLLpath, ...):
  unable to load shared object '/gpfs/projects/bgmp/agray11/miniconda3/envs/velocyto2/lib/R/library/png/libs/png.so':
  /lib64/libz.so.1: version 'ZLIB_1.2.9' not found (required by /projects/bgmp/agray11/miniconda3/envs/velocyto2/lib/libpng16.so.16)

### Will follow these issues to see if this resolves the error:
https://github.com/satijalab/seurat/issues/3543
https://github.com/satijalab/seurat/issues/3195

Uninstalled the Seurat package.
Uninstalled png package.
install.packages("png")
  DONE
Restart R session.
install.packages("Seurat")
  DONE
library(png)
  ERROR: package or namespace load failed for 'png' in dyn.load(file, DLLpath = DLLpath, ...):
  unable to load shared object '/gpfs/projects/bgmp/agray11/miniconda3/envs/velocyto2/lib/R/library/png/libs/png.so':
  /lib64/libz.so.1: version 'ZLIB_1.2.9' not found (required by /projects/bgmp/agray11/miniconda3/envs/velocyto2/lib/libpng16.so.16)

### Based on this error, seems like something is wrong with the png install? 
Going to try reinstalling a new environment for the r-base.
create new conda environment (velocyto)
conda create --name velocyto3
conda config --add channels bioconda
conda config --add channels conda-forge
conda install r-devtools
conda install r-base=4.0.2
conda install r-biomartr
conda install -c bioconda r-velocyto.r

### ...Forgot to activate environment!!!! Need to uninstall conda stuff.
conda remove r-velocyto.r
conda remove r-biomartr
conda remove r-base=4.0.2
conda remove r-devtools

### Now inside of the new environment:
conda activate velocyto3
conda config --add channels bioconda
conda config --add channels conda-forge
conda install r-base=4.0.2
conda install r-biomartr
conda install -c bioconda r-velocyto.r
conda install -c bioconda r-seurat
ml rstudio/1.0
ml R/4.0.2
rstudio
library(Seurat)
  ERROR: package or namespace load failed for 'Seurat' in dyn.load(file, DLLpath = DLLpath, ...):
  unable to load shared object '/gpfs/projects/bgmp/agray11/miniconda3/envs/velocyto3/lib/R/library/png/libs/png.so':
  /lib64/libz.so.1: version 'ZLIB_1.2.9' not found (required by gfps/projects/bgmp/agray11/miniconda3/envs/velocyto3/lib/R/library/png/libs/../../../../libpng16.so.16)
library(png)
  ERROR: package or namespace load failed for 'png' in dyn.load(fil, DLLpath = DLLpath, ...):
  unable to load shared object '/gpfs/projects/bgmp/agray11/miniconda3/envs/velocyto3/lib/R/library/png/libs/png.so': 
  /lib64/libz.so.1: version'ZLIB_1.2.9' not found (required by /gpfs/projects/bgmp/agray11/miniconda3/envs/velocyto3/lib/R/library/png/libs/../../../../libpng16.so.16)

### Interested in possibly trying this to resolve?
https://stackoverflow.com/questions/48306849/lib-x86-64-linux-gnu-libz-so-1-version-zlib-1-2-9-not-found
cd /your_software/../lib/ (the directory containing libz.so.1)
mv libz.so.1 libz.so.1.old
ln -s /lib/x86_64-linux-gnu/libz.so.1

When I cd into the /gpfs/projects/bgmp/agray11/miniconda3/envs/velocyto3/lib/R/library/png/libs/ directory, the only 
file present is the png.so (as expected). But I'm not sure how to get to this /lib64/libz.so.1
I'll ask Matt and Chris about this later today during our meeting.

  Chris couldn't find the attached file either, so doesn't look like it was just me. 
  He's going to try this solution:
  https://geeksww.com/tutorials/libraries/zlib/installation/installing_zlib_on_ubuntu_linux.php
  Didn't work :((




############################################################
######################## 01/07/2021 ########################
############################################################

### Going to try and install a different version of R first and then ml R/4.0.2 in a new environment.
conda create --name velocyto4
conda activate velocyto4
conda config --add channels bioconda
conda config --add channels conda-forge
conda install r-biomartr
conda install -c bioconda r-seurat
conda install -c bioconda r-velocyto.r
ml rstudio/1.0
ml R/4.0.2
rstudio
library(Seurat)
  ERROR: (same as above)


conda list | grep "r-base"
  r-base  4.0.3
conda list | grep "veloc"
  r-velocyto.r  0.6
ml rstudio/1.0
ml R/4.0.2
ml list
  1) slur/19.05   2) gcc/7.3    3) rstudio/1.0    4) R/4.0.2
rstudio
library(Seurat)
  ERROR: (same as above)

### Going to scp the loom file onto my computer and attempt it on here!!!
the velocyto .loom file for the vignette is here: 
/projects/bgmp/shared/groups/2020/neuron_nerds/CellRanger/cellranger-4.0.0/FullCounts/velocyto/FullCounts.loom
cat FullCounts.loom | wc -l
  396547  

(on local computer)
pwd
  /Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project
scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/CellRanger/cellranger-4.0.0/FullCounts/velocyto/FullCounts.loom .
$ ls -lah
total 365840
drwxr-xr-x  17 agray11  staff   544B Jan  7 13:28 .
drwxr-xr-x  24 agray11  staff   768B Dec 29 15:00 ..
-rw-r--r--   1 agray11  staff    17K Oct 23 16:53 .Rhistory
-rw-r--r--@  1 agray11  staff   2.3M Dec  7 10:30 Final_presentation.pdf
-rw-r-----   1 agray11  staff   118M Jan  7 13:28 FullCounts.loom
drwxr-xr-x   4 agray11  staff   128B Dec  6 19:52 PBMC_DATA
-rw-r--r--@  1 agray11  staff   9.9M Dec  4 18:30 SeuratFullCountsFilteredSCTransform_final_Gm10076.html
-rw-r--r--@  1 agray11  staff   9.8M Dec  6 10:06 SeuratFullCountsFilteredSCTransform_final_Group3markers_SoupX.html
-rw-r--r--   1 agray11  staff   4.4K Oct 26 11:18 Seurat_practice.R
-rw-r--r--@  1 agray11  staff   4.7M Dec  6 15:58 alltop_annotated_edited.xlsx
-rwxr-xr-x   1 agray11  staff   627B Oct 30 08:26 cellranger_countsV4.sh
-rw-r--r--@  1 agray11  staff    18K Dec  7 15:03 final_presentation_notes.docx
-rw-r-----@  1 agray11  staff   5.6M Dec  2 11:52 seurat_P10f_sct_mt2.html
-rw-r-----@  1 agray11  staff   5.1M Dec  2 13:17 seurat_P10f_sct_mt25.html
-rw-r-----@  1 agray11  staff   2.2M Nov 12 10:06 seurat_raw_mt10_v1.html
-rw-r-----@  1 agray11  staff   3.5M Nov 13 14:17 seurat_raw_mt10_v2.html
-rw-r-----@  1 agray11  staff   5.8M Nov 13 16:56 seurat_raw_mt10_v3.html

$ cat FullCounts.loom | wc -l
  396547

### Updated brew install to install compiler needed for velocyto.R
$ brew update

### File transfer seems to check out. Installing velocyto.R and SeuratWrappers on local:
Checking version of R in R:
> version
               _                           
platform       x86_64-apple-darwin17.0     
arch           x86_64                      
os             darwin17.0                  
system         x86_64, darwin17.0          
status                                     
major          4                           
minor          0.2                         
year           2020                        
month          06                          
day            22                          
svn rev        78730                       
language       R                           
version.string R version 4.0.2 (2020-06-22)
nickname       Taking Off Again    

BiocManager::install("pcaMethods")
  DONE
install.packages("hdf5r")
  ERROR: package or namespace load failed for ‘hdf5r’ in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-hdf5r/00new/hdf5r/libs/hdf5r.so':
  dlopen(/Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-hdf5r/00new/hdf5r/libs/hdf5r.so, 6): Library not loaded: @rpath/libhdf5_hl.100.dylib
  Referenced from: /Library/Frameworks/R.framework/Versions/4.0/Resources/library/00LOCK-hdf5r/00new/hdf5r/libs/hdf5r.so
  Reason: image not found
Error: loading failed
Execution halted

$ brew install hdf5
  Error: The following directories are not writable by your user:
  /usr/local/lib/pkgconfig
  /usr/local/share/man/man3
  /usr/local/share/man/man5

  You should change the ownership of these directories to your user.
    sudo chown -R $(whoami) /usr/local/lib/pkgconfig /usr/local/share/man/man3 /usr/local/share/man/man5

  And make sure that your user has write permission.
    chmod u+w /usr/local/lib/pkgconfig /usr/local/share/man/man3 /usr/local/share/man/man5

### Reading what this error message states:
https://stackoverflow.com/questions/25654315/granting-user-permissions-using-sudo-chown-r-useruser-dir-ectory
https://sites.alldaycity.com/mirageglobe/the-homebrew-doctor/
https://unix.stackexchange.com/questions/599341/what-is-the-difference-between-usr-lib-and-usr-local-lib

### Retrying now:
sudo chown -R $(whoami) /usr/local/lib/pkgconfig /usr/local/share/man/man3 /usr/local/share/man/man5
enter password
chmod u+w /usr/local/lib/pkgconfig /usr/local/share/man/man3 /usr/local/share/man/man5
brew install hdf5
cd /usr/local/Cellar/hdf5/1.12.0_1

install.packages("hdf5r)
  ERROR: 


On my own computer:
conda create --name velocyto
conda info --envs
# conda environments:
#
base                  *  /Users/agray11/anaconda3
velocyto                 /Users/agray11/anaconda3/envs/velocyto

conda activate veloctyo


############################################################
######################## 01/06/2021 ########################
############################################################

### Going to start the Jeffworks vignette:
conda activate velocyto2
ml rstudio/1.0
ml R/4.0.2
rstudio

### Need to save the Seurat counts matrix for this vignette:
Save the @counts data stored in the Seurat object. Will use Chris' .csv for this:

### R-package MUDAN:
https://rdrr.io/github/JEFworks/MUDAN/f/README.md
require(devtools)
devtools::install_github("JEFworks/MUDAN")

### Getting around the install error message:
https://github.com/r-lib/remotes/issues/434
Sys.setenv(R_REMOTES_NO_ERRORS_FROM_WARNINGS=TRUE)
require(devtools)
devtools::install_github("JEFworks/MUDAN")
  DONE

### Error message in MUDAN:plotEmbedding()
  ERROR: failed to load cairo DLLError in dev.control(displaylist = "enable") :
  dev.control() called without an open graphics device

### Troubleshooting:
install.packages("Cairo")
  DONE
Still getting error message...
https://stackoverflow.com/questions/49324130/cant-plot-because-failed-to-load-cairo-dll-in-rstudio-but-not-in-r
https://github.com/jupyter/docker-stacks/issues/382

According to these readings ^^ seems like it's an inherent issue b/c of r-base conda install.
Could try and show plot in script rater?

### Looking into biomaRt documentation:
https://bioconductor.org/packages/release/bioc/vignettes/biomaRt/inst/doc/biomaRt.html




############################################################
######################## 01/11/2021 ########################
############################################################

### Troubleshooting MUDAN::plotEmbedding() errors with Jason:
  Save environment  (environment_name_file_whatever.yaml)
  conda env export > env.yaml
  conda install zlib=1.2.9
  conda install mamba

### Transferred Matt's env from Talapas and stored it as a new env on my computer
cd /Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project
scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/mattisrad.yaml .
conda env create --name velocyto_tst --file file.yaml
conda activate velocyto_tst
open -na Rstudio

### Transfer the counts matrix to my computer:
cd /Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project
scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/chris/test_df.csv .

### The MUDAN::plotEmbedding() error was fixed!!!! But the atomic vector $
is still an issue... this is at this step:
  rvel.cd.unpooled <- gene.relative.velocity.estimates(
  emat,
  nmat,
  fit.quantile = 0.05,
  min.nmat.emat.correlation = 0.2,
  min.nmat.emat.slope = 0.2,
  kCells = 1
)
  fitting gamma coefficients ... done. succesfful fit for 9042 genes
  ERROR: $ operator is invalid for atomic vectors

### Going to try and troubleshoot by using the author's dataset and see if 
it throws the same error. Dataset is the supplemental Dataset_S12.csv:
Paper: https://www.pnas.org/content/116/39/19490/tab-figures-data
Dataset location: /Users/agray11/bioinformatics/Fall2020/Bi624_Lab/Group_Project/pnas.1912459116.sd12.csv

### Unfortunately getting the same error.... UGHHHHH. 
Going to try and create a new environment, install r-base=4.0.3 and then install 
packages via the RStudio-terminal

conda create --name velocyto_test2
conda activate velocyto_test2
conda config --add channels bioconda
conda config --add channels conda-forge
conda install r-base=4.0.2

open -na Rstudio
Sys.setenv(R_REMOTES_NO_ERRORS_FROM_WARNINGS=TRUE)
install.packages("devtools")
  ERROR: 
  Configuration failed to find libgit2 library. Try installing:
 * brew: libgit2 (MacOS)
 * deb: libgit2-dev (Debian, Ubuntu, etc)
 * rpm: libgit2-devel (Fedora, CentOS, RHEL)
If libgit2 is already installed, check that 'pkg-config' is in your
PATH and PKG_CONFIG_PATH contains a libgit2.pc file. If pkg-config
is unavailable you can set INCLUDE_DIR and LIB_DIR manually via:
R CMD INSTALL --configure-vars='INCLUDE_DIR=... LIB_DIR=...'

brew install libgit2

install.packages("devtools")
  DONE
library(devtools)
devtools::install_github("velocyto-team/Velocyto.R)
  ERROR: ERROR: dependencies ‘pcaMethods’, ‘hdf5r’ are not available for package ‘velocyto.R’
  * removing ‘/Users/agray11/anaconda3/envs/velocyto_test2/lib/R/library/velocyto.R’
  Warning messages:
  1: package ‘pcaMethods’ is not available (for R version 4.0.2) 
  2: In i.p(...) : installation of package ‘hdf5r’ had non-zero exit status
  3: In i.p(...) :
    installation of package ‘/var/folders/h2/blfk4m154qs66xzbtkw5r43r0000gn/T//RtmpsRCglg/file17e3e1b6e4aa8/velocyto.R_0.6.tar.gz’ had non-zero exit status

if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install(version = "3.12")

BiocManager::install("pcaMethods")
  DONE

install.packages("hdf5r")
  ERROR: In file included from const_export.c:23:
  In file included from ./const_export.h:22:
  ./global.h:23:10: fatal error: 'hdf5.h' file not found
  #include <hdf5.h>
          ^~~~~~~~
  1 error generated.
  make: *** [/Users/agray11/anaconda3/envs/velocyto_test2/lib/R/etc/Makeconf:168: const_export.o] Error 1
  ERROR: compilation failed for package ‘hdf5r’
  * removing ‘/Users/agray11/anaconda3/envs/velocyto_test2/lib/R/library/hdf5r’

### Possible solution to the hdf5r error:
https://github.com/hhoeflin/hdf5r/issues/112

conda install -c anaconda hdf5
install.packages("hdf5r")
  DONE
devtools::install_github("JEFworks/MUDAN")
  ERROR: ERROR: lazy loading failed for package ‘MUDAN’
* removing ‘/Users/agray11/anaconda3/envs/velocyto_test2/lib/R/library/MUDAN’
Error: Failed to install 'MUDAN' from GitHub:
  (converted from warning) installation of package ‘/var/folders/h2/blfk4m154qs66xzbtkw5r43r0000gn/T//Rtmpkxj5EM/fileaa8f63b617a5/MUDAN_0.1.0.tar.gz’ had non-zero exit status

### FDSJKAL;FJDKAHGIREOW!!! GIVING UP. Moving on to subclustering in Seurat...
Want to subcluster the mOSNs to see if we can separate out the early-born vs. late-born cells.
To get the clusters from the Seurat object:
seurat_object@meta.data$seurat_clusters



############################################################
######################## 03/01/2021 ########################
############################################################

### Installing new environment to run scVelo for RNA velocity.
conda activate bgmp_py37
cd /projects/bgmp/shared/groups/2020/neuron_nerds/alyx
conda env export > bgmp_py37_new.yaml
conda env create --name scVelo --file bgmp_py37_new.yaml
conda activate scVelo
conda install scVelo
ml rstudio/1.0
ml R/4.0.2

### Just kidding, fresh environment...
conda env create --name scVelo2
conda activate scVelo2
conda config --add channels bioconda
conda config --add channels conda-forge

### Was getting a conda channels error message
### Removed channels and trying again.
conda config --remove-key channels
conda config --add channels bioconda
conda config --add channels conda-forge
conda install scVelo
ml rstudio/1.0
ml R/4.0.2
rstudio
library(Seurat)
library(remotes)
remotes::install_github("mojaveazure/seurat-disk")
- Error... unable to load hdf5r dependencies
conda install -c bioconda r-seurat
conda install -c conda-forge r-hdf5r
conda install -c bu_cnio r-seuratwrappers
ml rstudio/1.0
ml R/4.0.2
rstudio
library(Seurat)
  ERROR: package or namespace load failed for "Seurat' in dyn.load(file, DLLpath = DLLpath, ...):
  unable to load shared object '/gpfs/projects/bgmp/agray11/miniconda3/envs/scVelo2/lib/R/library/Rcpp/libs/Rcpp.so':
  /packages/gcc/7.3 lib64/libstdc++.so.6: version 'GLIBCXX_3.4.26' not found (required by 
  /gpfs/projects/bgmp/agray11/miniconda3/envs/scVelo2/lib/R/library/Rcpp/libs/Rcpp.so)
Sys.setenv(R_REMOTES_NO_ERRORS_FROM_WARNINGS=TRUE)
library(Seurat)
  ERROR (same as above)
library(Rcpp)
  ERROR (same as above)
conda install -c conda-forge r-rcpp
  # All requested packages already installed.

ml purge
ml slurm/19.05 gcc/7.3
ml rstudio/1.0
ml R/4.0.2
rstudio
install.packages("Rcpp")
  DONE
library(Seurat)
  ERROR

conda list | grep "r-base"
r-base 3.6.3 ## Need to remove and replace with r-base=4.0.2
conda install r-base=4.0.2
#remotes::install_github("satijalab/seurat-wrappers")

### Redoing a new environment...
ml rstudio/1.0
ml R/4.0.2
conda deactivate
conda create --name scVelo3
conda activate scVelo3
conda install r-base=4.0.2
conda install -c conda-forge r-hdf5r
conda install -c bioconda r-seurat
conda install -c bu_cnio r-seuratwrappers
rstudio
library(Seurat)
  ERROR: package or namespace load failed for 'Seurat' in dyn.load(file, DLLpath - DLLpath, ...):
  unable to load shared object '/gpfs/projects/bgmp/agray11/miniconda/envs/velocyto2/lib/R/library/png/libs/png.so':
  /lib64/libz.so.1: version 'ZLIB_1.2.9' not found (required by /projects/bgmp/agray11/miniconda3/envs/velocyto2/lib/libpng16.so.16)


############################################################
######################## 03/03/2021 ########################
############################################################

### Trying again to get scVelo up and running:

conda create --name scVelo4
conda activate scVelo4
ml purge
ml slurm/19.05 gcc/7.3
ml rstudio/1.0
ml R/4.0.2
rstudio
library(Seurat) - Worked!!
library(remotes)
remotes::install_github('satijalab/seurat-wrappers')
  DONE
library(SeuratWrappers) - Worked!!
remotes::install_github("mojaveazure/seurat-disk")
  ERROR: configureation failed for package 'hdf5r'
install.packages("hdfr5")
  ERROR: hdf5 does not seem to be installed on your platform.
  Please install the hdf5 library.

### In scVelo4 environment and closed out of Rstudio:
ml purge
ml slurm/19.05 gcc/7.3
conda install -c conda-forge hdf5
  DONE
ml rstudio/1.0
ml R/4.0.2
library(Seurat) - Worked!
library(SeuratWrappers) - Worked!
remotes::install_github("mojaveazure/seurat-disk")
  ERROR: installation of package 'hdf5r' had non-zero exit status.
install.packages("hdf5r)
  ERROR: package or namespace load failed for 'hdf5r' in dyn.load(file, DLLpath = DLLpath, ...):
  unable to load shared object '/gpfs/home/agray11/R/x86_64-pc-linux-gnu-library/4.0/00LOCK-hdf5r/00new/hdf5r/libs/hdf5r.so':
  libhdf5_hl.so.200: cannot open shared object file: No such file or directory.

### Seems like I need to download the hdf5 library through sudo or brew, but
can't do that on Talapas. Try on the local computer??
brew update
conda create --name scVelo4
conda activate scVelo4
open -na Rstudio
> R version 4.0.2 (2020-06-22) 
library(Seurat) - Worked!
remotes::install_github('satijalab/seurat-wrappers')
  DONE
library(SeuratWrappers) - Worked!
remotes::install_github("mojaveazure/seurat-disk")
  DONE
library(SeuratDisk) - Worked!

### Closed Rstudio, back on terminal:
conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge
conda install scvelo
  DONE
open -na Rstudio 
library(Seurat)
library(SeuratWrappers)
library(SeuratDisk)
  -- All good so far...

### Location of .loom file:
cd /Users/agray11/bioinformatics/FALL2020/Bi624_Lab/Group_Project
scp agray11@talapas-ln1.uoregon.edu:/projects/bgmp/shared/groups/2020/neuron_nerds/CellRanger/cellranger-4.0.0/FullCounts/velocyto/FullCounts.loom .

### Reading in the data in Rstudio and got this handy notification:
>ldat <- ReadVelocity(file = "FullCounts.loom")
  Package velocyto-team/velocyto.R is not yet installed. Install now?

### I thought this didn't require velocyto.R!?!? ***SIGH***
remotes::install_github("velocyto-team/velocyto.R")
  ERROR: ld: warning: directory not found for option '-L/usr/local/gfortran/lib/gcc/x86_64-apple-darwin18/8.2.0'
  ld: warning: directory not found for option '-L/usr/local/gfortran/lib'
  ld: library not found for -lgfortran
  clang: error: linker command failed with exit code 1 (use -v to see invocation)
  make: *** [velocyto.R.so] Error 1
  ERROR: compilation failed for package ‘velocyto.R’
  * removing ‘/Library/Frameworks/R.framework/Versions/4.0/Resources/library/velocyto.R’
  installation of package ‘/var/folders/h2/blfk4m154qs66xzbtkw5r43r0000gn/T//RtmpWzQZTP/file124281e7a7642/velocyto.R_0.6.tar.gz’ had non-zero exit statusError in loadNamespace(name) : there is no package called ‘velocyto.R’

### Possible solutions?
https://medium.com/biosyntax/following-up-library-dependency-when-compiling-r-packages-89f191b9f227
https://github.com/ponylang/ponyc/issues/3684
$ which clang
/usr/bin/clang
(scVelo4) MacBook-Pro:local agray11$ clang -v
Apple clang version 12.0.0 (clang-1200.0.32.29)
Target: x86_64-apple-darwin20.3.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin

$ which gfortran
/usr/local/bin/gfortran
(scVelo4) MacBook-Pro:local agray11$ gfortran -v
Using built-in specs.
COLLECT_GCC=gfortran
COLLECT_LTO_WRAPPER=/usr/local/Cellar/gcc/10.2.0_2/libexec/gcc/x86_64-apple-darwin19/10.2.0/lto-wrapper
Target: x86_64-apple-darwin19
Configured with: ../configure --build=x86_64-apple-darwin19 --prefix=/usr/local/Cellar/gcc/10.2.0_2 --libdir=/usr/local/Cellar/gcc/10.2.0_2/lib/gcc/10 --disable-nls --enable-checking=release --enable-languages=c,c++,objc,obj-c++,fortran --program-suffix=-10 --with-gmp=/usr/local/opt/gmp --with-mpfr=/usr/local/opt/mpfr --with-mpc=/usr/local/opt/libmpc --with-isl=/usr/local/opt/isl --with-system-zlib --with-pkgversion='Homebrew GCC 10.2.0_2' --with-bugurl=https://github.com/Homebrew/homebrew-core/issues --disable-multilib --with-native-system-header-dir=/usr/include --with-sysroot=/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk SED=/usr/bin/sed
Thread model: posix
Supported LTO compression algorithms: zlib
gcc version 10.2.0 (Homebrew GCC 10.2.0_2) 

https://developer.apple.com/forums/thread/666700
$ sudo xcode-select --install
Password:
xcode-select: error: command line tools are already installed, use "Software Update" to install updates

### Forget about using that old vignette: going to use this one instead:
https://github.com/basilkhuder/Seurat-to-RNA-Velocity#extracting-meta-data
For the new environment (FOLLOW THE ONES BELOW!!!!):
    DIDN'T DO THESE:::::::::::
    conda create --name scVelo5
    conda activate scVelo5
    conda install -c bioconda scvelo
    #conda install numpy scipy cython numba matplotlib scikit-learn h5py click
    #conda install velocyto
    #conda install anndata -c bioconda
    conda install -c conda-forge jupyterlab
    conda install -c conda-forge notebook

### FOLLOW THIS:
conda create --name scVelo5
conda activate scVelo5
conda install -c bioconda scvelo
conda install -c conda-forge jupyterlab
conda install -c conda-forge notebook
